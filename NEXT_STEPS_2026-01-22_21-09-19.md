# Riscovery RFQ System - Next Steps

**Generated:** 2026-01-22 21:09:19
**Author:** Development Session with Claude

---

## What Was Completed

### 1. Dynamic Questionnaire System (Database-Driven)

- **Database Schema**: Added 4 new Prisma models
  - `QuestionnaireTemplate` - Sector-based templates
  - `QuestionnaireSection` - Grouped sections
  - `Question` - Individual questions with conditional logic
  - `CoverageRule` - Coverage recommendation rules

- **Admin API Endpoints** (`/api/v1/rfq/admin/...`)
  - Full CRUD for templates, sections, questions, and rules
  - Reorder, duplicate, and toggle functionality

- **Admin UI** (`/rfq/admin/templates`)
  - Template list with filtering
  - Template editor with sections and questions
  - Question editor dialog
  - Rule builder with visual condition/action configuration
  - Priority phases with user-friendly labels

### 2. Coverage Rules Engine

- **8 Sectors with Rules**:
  | Sector | Hebrew | Rules Count |
  |--------|--------|-------------|
  | CONSTRUCTION | בנייה | 11 |
  | TECHNOLOGY | טכנולוגיה | 9 |
  | HEALTHCARE | בריאות | 8 |
  | MANUFACTURING | ייצור | 9 |
  | RETAIL | קמעונאות | 9 |
  | LOGISTICS | לוגיסטיקה | 9 |
  | CONSULTING | ייעוץ | 9 |
  | GENERIC | כללי | 7 |

- **Rule Actions**: adjustLimit, addEndorsement, setMandatory, addPolicy, removePolicy
- **Priority System**: 6 phases (10-60) for ordered rule evaluation

### 3. Client Questionnaire Improvements

- Progress indicator with percentage
- Load previous draft answers automatically
- Required field validation before submission
- Save notification feedback
- Rule attribution in recommendations display

---

## Recommended Next Steps

### Priority 1: Core Functionality

#### 1.1 Email Integration
- Send questionnaire links to clients via email
- Email notifications when questionnaire is completed
- Reminder emails for incomplete questionnaires

**Files to create:**
- `/apps/api/src/modules/email/email.service.ts`
- `/apps/api/src/modules/email/email.routes.ts`
- Email templates (HTML)

#### 1.2 User Authentication & Multi-tenancy
- User login/registration
- Organization/tenant management
- Role-based access control (Admin, Agent, Client)
- Replace `TEMP_ORG_ID` with real organization context

**Files to modify:**
- All route files to get organizationId from authenticated user
- Add auth middleware

#### 1.3 Client Self-Service Portal
- Public questionnaire link (no login required)
- Client can fill questionnaire directly
- Automatic client creation from questionnaire submission

**Files to create:**
- `/apps/web/src/app/public/questionnaire/[token]/page.tsx`
- Token generation and validation service

### Priority 2: Enhanced Features

#### 2.1 Document Generation Improvements
- PDF styling and branding
- Hebrew RTL support in documents
- Company logo integration
- Multiple document templates

#### 2.2 Insurer Management
- Insurer database (company profiles, contacts)
- Send RFQ to multiple insurers
- Track insurer responses
- Quote comparison tool

**Files to create:**
- `/apps/api/src/modules/insurers/`
- `/apps/web/src/app/rfq/insurers/`

#### 2.3 Analytics Dashboard
- Questionnaire completion rates
- Most common coverage recommendations
- Rule trigger frequency
- Client sector distribution

### Priority 3: Advanced Features

#### 3.1 Questionnaire Versioning
- Track template changes over time
- Version compatibility for existing questionnaires
- Migration tools for template updates

#### 3.2 Bulk Operations
- Import clients from CSV/Excel
- Send questionnaire to multiple clients
- Batch document generation

#### 3.3 Integration APIs
- Webhook notifications
- External CRM integration
- Insurance company API integration

#### 3.4 AI Enhancements
- Smart question suggestions based on sector
- Automatic rule generation from historical data
- Risk prediction improvements

---

## Technical Debt

### High Priority
1. Remove `eslint-disable @typescript-eslint/no-explicit-any` after running `prisma generate`
2. Add proper error handling and logging
3. Add unit tests for rules engine
4. Add E2E tests for questionnaire flow

### Medium Priority
1. Add request validation schemas for all endpoints
2. Implement proper pagination for list endpoints
3. Add caching for frequently accessed templates
4. Optimize database queries

### Low Priority
1. Code documentation
2. API documentation (OpenAPI/Swagger)
3. Performance monitoring
4. Accessibility improvements (a11y)

---

## File Structure Reference

```
apps/
├── api/src/modules/rfq/
│   ├── admin/
│   │   ├── admin.routes.ts
│   │   ├── template.service.ts
│   │   ├── section.service.ts
│   │   ├── question.service.ts
│   │   └── rule.service.ts
│   ├── questionnaire/
│   │   ├── questionnaire.routes.ts
│   │   ├── questionnaire.service.ts
│   │   ├── questionnaire.templates.ts
│   │   └── questionnaire.types.ts
│   ├── documents/
│   │   ├── document.routes.ts
│   │   └── document.service.ts
│   └── clients/
│       ├── client.routes.ts
│       └── client.service.ts
│
└── web/src/app/rfq/
    ├── admin/templates/
    │   ├── page.tsx (list)
    │   ├── new/page.tsx
    │   └── [id]/
    │       ├── page.tsx (editor)
    │       └── rules/page.tsx
    ├── clients/
    │   ├── page.tsx (list)
    │   ├── new/page.tsx
    │   └── [id]/page.tsx (detail)
    ├── questionnaire/[clientId]/page.tsx
    └── documents/[clientId]/page.tsx
```

---

## Quick Commands

```bash
# Start development servers
cd /Users/aviluvchik/app/Riscovery
npm run dev

# Generate Prisma client after schema changes
cd apps/api && npx prisma generate

# Push schema changes to database
cd apps/api && npx prisma db push

# Seed questionnaire templates
cd apps/api && npx tsx prisma/seed-templates.ts

# Run TypeScript check
npx tsc --noEmit
```

---

## URLs

- **Web App**: http://localhost:3000
- **API**: http://localhost:3001
- **Clients List**: http://localhost:3000/rfq/clients
- **Templates Admin**: http://localhost:3000/rfq/admin/templates

---

*This document was auto-generated during a development session. Update as needed.*
